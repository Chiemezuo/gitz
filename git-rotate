#!/usr/bin/env python3
from gitz import git_functions
from gitz import program
from gitz.git import GIT

USAGE = """\
git-rotate: Rotate through all branches

USAGE:
    git rotate [<number-of-positions>]
"""

HELP = """
Change the current branch by rotating through all the branches for this repo
in the order given by the `git branch` command

EXAMPLES:
    git rotate
        Rotate to the next branch

    git rotate 3
        Rotate 3 branches ahead

    git rotate -1
    git rotate -
        Rotate 1 branch backward
"""
PROGRAM = program.Program(USAGE, HELP)


def git_rotate(delta='1'):
    PROGRAM.check_help()
    PROGRAM.require_git()

    delta = -1 if delta == '-' else int(delta)

    branches = git_functions.branches()
    pos = branches.index(git_functions.current_branch()) + delta
    GIT.checkout(branches[pos % len(branches)])


if __name__ == '__main__':
    git_rotate(*PROGRAM.argv)
